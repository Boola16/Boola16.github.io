<!DOCTYPE html>
<html>
<head>
  <link rel="icon" href="https://art.pixilart.com/sr5zfaad98ce16aws3.png" type="image/x-icon"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Fredoka:wght@300..700&family=Press+Start+2P&display=swap" rel="stylesheet">

  <meta charset="UTF-8">
  <title>SebWeb Chatbot</title>

  <style>
    body {
      margin: 0;
      font-family: 'Press Start 2P';
      background: url('https://www.topgear.com/sites/default/files/2021/08/04%20DSC06357.jpg') no-repeat center center fixed;
      background-size: cover;
      color: white;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #backButtonContainer {
      position: absolute;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }

    #backButton {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 10px 16px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-family: 'Press Start 2P';
      cursor: pointer;
      box-shadow: 0 4px 30px rgba(0,0,0,0.3);
    }

    .chatbox {
      width: 75%;
      max-width: 1000px;
      height: 70vh;
      padding: 16px;
      border-radius: 16px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      box-shadow: 0 4px 30px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 12px;
    }

    .msg {
      padding: 10px;
      border-radius: 10px;
      max-width: 75%;
      white-space: pre-wrap;
      line-height: 1.4;
      word-break: break-word;
      overflow-wrap: anywhere;
    }

    .user { align-self: flex-end; background: #3b82f6; color: white; }
    .bot { align-self: flex-start; background: #0f172a; border: 1px solid #334155; }

    .input-area {
      display: flex;
      gap: 8px;
    }

    input {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #334155;
      background: rgba(15,23,42,0.8);
      color: white;
      font-family: 'Press Start 2P';
    }

    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Press Start 2P';
    }
  </style>
</head>
<body>

<!-- BACK BUTTON -->
<div id="backButtonContainer">
  <button id="backButton" onclick="window.location.href='index.html'">
    ‚Üê Back to New Tab
  </button>
</div>

<!-- CHATBOX -->
<div class="chatbox">
  <div class="messages" id="messages"></div>
  <div class="input-area">
    <input id="input" placeholder="Say something..." />
    <button id="send">Send</button>
  </div>
</div>

<script>
  const messagesEl = document.getElementById("messages");
  const inputEl = document.getElementById("input");

  // --- Chatbot Responses ---
  const responses = [
    { mode: "any", triggers: ["hello","hi"], reply: "Hello! How are you?" },
    { mode: "any", triggers: ["joke"], reply: "Why did the developer go broke? Because he cleared his cache!" },
    { mode: "any", triggers: ["day","weekday"], reply: "Today is {day}." },
    { mode: "any", triggers: ["date","today"], reply: "Today's date is {date}." },
    { mode: "any", triggers: ["time","clock"], reply: "The current time is {time}." },
    { mode: "all", triggers: ["your","creator"], reply: "Seb is my creator, and his platform is SebWeb." }
  ];

  // Dynamic placeholder functions
  function getDayOfWeek() {
    return ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date().getDay()];
  }
  function getDate() { return new Date().toLocaleDateString(); }
  function getTime() { return new Date().toLocaleTimeString(); }

  function addMsg(role, text) {
    const div = document.createElement("div");
    div.className = "msg " + role;
    div.textContent = text;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  // NEW RELIABLE PEXELS IMAGE SEARCH (no key needed)
 function addStockImage(prompt) {
  if (!prompt) return;

  // Loading placeholder
  const placeholder = document.createElement("div");
  placeholder.textContent = "Loading image...";
  placeholder.style.color = "#aaa";
  messagesEl.appendChild(placeholder);

  // Unsplash Source API (no API key needed)
  const imgURL = `https://source.unsplash.com/featured/?${encodeURIComponent(prompt)}`;

  const img = new Image();
  img.src = imgURL;
  img.style.maxWidth = "100%";
  img.style.borderRadius = "10px";
  img.style.marginTop = "5px";

  img.onload = () => {
    messagesEl.removeChild(placeholder);
    messagesEl.appendChild(img);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  };

  img.onerror = () => {
    messagesEl.removeChild(placeholder);
    addMsg("bot", "Image failed to load.");
  };
}


  // Reply System
  function getReply(text) {
    const lower = text.toLowerCase();
    const out = [];

    for (const r of responses) {
      const match = r.mode === "any"
        ? r.triggers.some(t => lower.includes(t))
        : r.triggers.every(t => lower.includes(t));

      if (match) {
        out.push(
          r.reply
            .replace("{day}", getDayOfWeek())
            .replace("{date}", getDate())
            .replace("{time}", getTime())
        );
      }
    }

    return out.length ? out.join("\n") : "Sorry, I don't understand that yet.";
  }

  // FULLY UPDATED SEND FUNCTION
  function send() {
    const text = inputEl.value.trim();
    if (!text) return;

    addMsg("user", text);
    inputEl.value = "";

    const lower = text.toLowerCase();
    const trigger1 = "make me an image of";
    const trigger2 = "generate an image of";

    // Image request
    if (lower.startsWith(trigger1) || lower.startsWith(trigger2)) {
      const prompt = lower.replace(trigger1, "").replace(trigger2, "").trim();
      if (!prompt) {
        addMsg("bot", "Please specify what you want an image of.");
        return;
      }
      generateStockImage(prompt);
      return;
    }

    // Normal chat reply
    addMsg("bot", getReply(text));
  }

  // Event Listeners
  inputEl.addEventListener("keydown", e => { if (e.key === "Enter") send(); });
  document.getElementById("send").addEventListener("click", send);
</script>

</body>
</html>
